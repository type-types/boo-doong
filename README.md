## 부등부등 웹스터디

간단한 공부방 생성·입장, 실시간 채팅, 개인 LLM 대화를 제공하는 웹 데모입니다. 이 문서는 WBS(Work Breakdown Structure)와 진행 흐름을 기준으로 프로젝트를 이해·추진할 수 있도록 재구성되었습니다.

### 핵심 기능(데모 기준)

- **공부방 관리**: 방 목록, 방 생성(제목/정원/시간/옵션), 방 입장
- **실시간 채팅**: 방장/참가자 역할, 타이핑 표시, 시스템 메시지, 최근 이력 로드(50), 서버 보관(최대 500)
- **LLM 개인 대화**: `/api/llm/chat` 프록시. 키 없으면 400 에러 안내

### 기술 스택

- Node.js, TypeScript
- Express 5, Socket.IO 4
- ts-node, nodemon

---

## 빠른 시작

### 요구사항

- Node.js 18 이상 권장

### 설치

```bash
# pnpm 권장
pnpm install

# 또는 npm
npm install
```

### 환경 변수

프로젝트 루트에 `.env` 파일을 생성합니다.

```bash
# 서버 포트 (기본 4000)
PORT=4000

# OpenAI 연동용 API 키(LLM 기능 사용 시 필수)
OPENAI_API_KEY=sk-...
```

### 실행

```bash
# 개발 모드 (자동 재시작)
pnpm dev
# 또는
npm run dev
```

접속 경로

- 방 목록: `http://localhost:4000/rooms.html`
- 채팅: `http://localhost:4000/index.html` (루트 `/` 접근 시 `rooms.html`로 리다이렉트)

---

## 디렉터리 구조

```text
public/
  index.html     # 방 내 채팅 + LLM 개인 대화 UI
  rooms.html     # 방 목록/생성/입장 UI
src/
  server.ts      # Express + Socket.IO 서버, REST/WS/LLM API
  static.ts      # (예비) 정적 자원 마운트 유틸
package.json     # 스크립트/의존성 (type: commonjs)
tsconfig.json    # TS 컴파일 옵션
```

---

## WBS(Work Breakdown Structure)

아래 WBS는 제공된 시트 기준으로 핵심 작업을 도메인별로 정리한 것입니다.

### 공통작업

- 팀 전체: 부등부등 웹스터디 UI 제작
- 팀 전체: 데이터베이스 스키마 설계

### 회원가입 및 로그인

- [백엔드] UserDB 생성 및 회원가입 정보 저장
- [프런트엔드] 로그인 화면 제작
- [백엔드] UserDB 조회 및 인증 유지
- [프런트엔드] 소셜로그인 API 연동

### 스터디룸 조회

- [프런트엔드] 스터디룸 목록/필터 UI
- [프런트엔드] 스터디룸 개설 UI
- [백엔드] 스터디룸 개설 정보 검증·생성
- [프런트엔드] 웹스터디룸 내부 UI 제작
- [백엔드] 참가자 프로필 조회 및 DB 호출

### 스터디룸 입장 및 퇴장

- [프런트엔드] WebRTC 음성 연결 UI 초안
- [백엔드] WebRTC 연결 시그널 서버 준비
- [프런트엔드] 실시간 채팅 UI 구현
- [백엔드] LLM API 프록시 및 체팅 처리
- [프런트엔드] 타이핑/공지/제약 UI 구현
- [백엔드] Socket 이벤트 및 제약 처리

### 스터디룸 종료

- [백엔드] 생성형 학습노트 생성/참가자 User의 마이페이지로 저장
- [프런트엔드] 스터디룸 결산 화면 제작 및 저장 데이터 표시

### 마이페이지

- [프런트엔드] 마이페이지 초기 UI 제작
- [백엔드] User DB 호출을 통한 프로필 필터링 제공
- [프런트엔드] 참여한 스터디룸 목록/노트/경험치 표시
- [백엔드] 학습노트 목록·요약 제공 API
- [프런트엔드] 학습노트 목록 뷰 구성
- [백엔드] User 프로필 조회 및 DB 호출

> 주: 상기 작업 중 일부는 본 데모 레포에 부분 구현되어 있으며, 나머지는 로드맵 대상입니다.

---

## 진행 흐름 및 의존성

아래 흐름은 병렬 가능한 단계와 선후 관계를 명시합니다. 팀 운영과 스프린트 계획의 기준으로 사용합니다.

### 규칙 요약

- 1단계가 모든 작업의 선행 조건입니다.
- 1 완료 후 2-1(디자인), 2-2(프런트 뼈대), 2-3(백엔드)은 병렬 진행 가능합니다.
- 2-2a: 2-2가 완료된 부분에 한해 2-1 결과물을 즉시 적용합니다.
- 2-3a: 2-3 완료 후 프런트-백 연동/테스팅을 수행합니다.
- 3(운영/배포/QA/피드백)은 상시 수행됩니다. 2-2 완료 직후 MVP 배포 가능하며, 디자인 적용 또는 API 연동 완료 범위도 수시 배포 가능합니다.

### 상세 정의

- 1. 기획자/PM

  - 러프 프로토타입(Figma/Paper) 제작
  - 명세서(SRS) 작성
  - 이후 모든 작업의 선행 조건

- 2-1. 디자인

  - 러프 프로토타입 구체화 -> Figma 디자인 작업
  - Rive 애니메이션 설계

- 2-2. 프론트 (뼈대 구축)

  - 러프 프로토타입 & 명세 기반 최소 작동 뼈대 개발
  - 2-2a. 디자인 적용 (2-2 완료된 부분에 대해서 2-1 완성된 부분 반영)

- 2-3. 백엔드

  - DB 구조 및 API 구축
  - 2-3a. 연동 엔지니어(테스팅 포함) 단계 진행 (프론트-백 연동)

- 3. 운영/배포/QA/피드백
  - 운영/배포 (DevOps/Infra, MVP 배포) -> 이론상 2-2가 끝나고 바로 배포 가능
  - 디자인 적용 되거나, API 연결이 완료된 것도 배포 가능
  - 전 과정에서 상시 개입 (애자일 방식), 구글 폼 등으로 피드백 수집

### ASCII 흐름 다이어그램

```
[1 기획/명세] ──▶  ┌─▶ [2-1 디자인]
                   ├─▶ [2-2 프런트 뼈대] ──▶ (2-2a 디자인 적용: 진행형)
                   └─▶ [2-3 백엔드] ───────▶ (2-3a 연동/테스트)

운영/배포/QA/피드백(3 상시) ─────────────────────────┬─ 2-2 완료 즉시 MVP 배포 가능
                                                    └─ 디자인/연동 완료 범위도 수시 배포
```

운영 팁

- 병렬 단계는 PR 라벨로 스트림을 구분(`feat/frontend`, `feat/backend`, `ops/devops`, `qa/validation`).
- 2-3a(연동) 이전에 API 스키마와 목 서버를 먼저 공유하면 프런트 뼈대/디자인 적용(2-2/2-2a) 속도를 끌어올릴 수 있습니다.

---

## 현재 구현 범위(데모)와 로드맵

### 현재 구현(이 레포)

- FR-04 기본 방 생성, FR-05 방 참여
- FR-06 채팅(WebSocket), 타이핑 표시, 시스템 메시지
- FR-07 개인 LLM 프록시(`/api/llm/chat`) — `.env`에 키 없으면 400 반환
- 반응형 UI 일부(모바일 대응)

### 로드맵(우선순 제안)

- FR-01 로그인/소셜, 세션·인증
- FR-02/03 프로필(본인/타인) 조회
- FR-06 음성(WebRTC) 연결(시그널링/권한)
- FR-08~10 종료 요약·저장·결산창
- FR-11~12 마이페이지/퀴즈
- DB 영속화, 성능 최적화(NFR 충족), 모니터링/로깅/알람

---

## REST API 요약

### GET `/api/rooms`

방 목록을 반환합니다.

```json
{
  "items": [
    {
      "id": "room-xxxx",
      "title": "새 공부방",
      "maxMembers": 6,
      "hostPresent": true,
      "players": 2,
      "createdAt": 1710000000000,
      "studyStart": "09:00",
      "studyEnd": "10:00",
      "noteRequired": false,
      "isPrivate": false
    }
  ]
}
```

### POST `/api/rooms`

방을 생성합니다.

```json
{
  "title": "문제풀이 스터디",
  "maxMembers": 6,
  "studyStart": "09:00",
  "studyEnd": "10:00",
  "noteRequired": true,
  "isPrivate": false
}
```

### POST `/api/llm/chat`

개인 LLM 프록시. 키가 없으면 400 에러 메시지를 반환합니다.
요청 예시(대화 히스토리 형식):

```json
{
  "messages": [
    { "role": "user", "content": "안녕" },
    { "role": "assistant", "content": "안녕하세요!" },
    { "role": "user", "content": "요약해줘" }
  ]
}
```

---

## WebSocket 이벤트 요약

- `join({ roomId, nickname, role })` → 합류, 정원/호스트 중복 검사
- `participants` → 현재 참가자 목록 브로드캐스트
- `chat_send({ roomId, text })` / `chat` / `chat_history`
- `typing({ roomId, typing })` / `typing_state`
- `leave()` / 소켓 `disconnect` 처리, 비어 있는 방 정리

---

## 운영/배포 참고

- 데모 목적의 간단 서버입니다. 프로덕션에서는 빌드 또는 런타임 트랜스파일 의존 최소화를 권장합니다.
- CORS는 `*`로 개방되어 있습니다. 환경에 맞게 제한을 적용하세요.

---

## 라이선스

- ISC (패키지 메타데이터 참고)
